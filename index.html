<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Flag Knock-Out Tournament</title>

<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    margin: 0;
    padding: 1rem;
    background: #f4f4f4;
    text-align: center;
  }

  h1 {
    font-size: 1.4rem;
    margin-bottom: 0.5rem;
  }

  .controls {
    margin-bottom: 1rem;
    font-size: 0.9rem;
  }

  .round {
    font-size: 0.9rem;
    margin-bottom: 1rem;
    color: #555;
  }

  .match {
    display: flex;
    gap: 1rem;
    justify-content: center;
  }

  .flag-card {
    background: white;
    border-radius: 12px;
    padding: 1rem;
    width: 45%;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .flag {
    font-size: 4rem;
    margin-bottom: 0.5rem;
    min-height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .flag img {
    width: 80px;
    height: auto;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    opacity: 0;
    transition: opacity 0.2s ease-in;
  }

  .flag img.loaded {
    opacity: 1;
  }

  button {
    padding: 0.5rem;
    font-size: 1rem;
    border: none;
    border-radius: 8px;
    background: #222;
    color: white;
  }

  button:active {
    transform: scale(0.97);
  }

  .winner {
    margin-top: 2rem;
  }

  .winner .flag {
    font-size: 6rem;
    min-height: 120px;
  }

  .winner .flag img {
    width: 160px;
  }

  .ranking {
    margin-top: 2rem;
    text-align: left;
    background: white;
    padding: 1rem;
    border-radius: 12px;
  }

  .ranking ol {
    padding-left: 1.2rem;
  }
</style>
</head>

<body>

<h1>Coolest Country Flag</h1>

<div class="controls">
  <label>
    <input type="checkbox" id="toggleNames" checked />
    Show country names
  </label>
</div>

<div class="round" id="roundInfo"></div>
<div id="app"></div>

<script>
const flags = [
  { name:"Afghanistan",emoji:"ðŸ‡¦ðŸ‡«",code:"af"},{name:"Albania",emoji:"ðŸ‡¦ðŸ‡±",code:"al"},
  { name:"Algeria",emoji:"ðŸ‡©ðŸ‡¿",code:"dz"},{name:"Andorra",emoji:"ðŸ‡¦ðŸ‡©",code:"ad"},
  { name:"Angola",emoji:"ðŸ‡¦ðŸ‡´",code:"ao"},{name:"Argentina",emoji:"ðŸ‡¦ðŸ‡·",code:"ar"},
  { name:"Armenia",emoji:"ðŸ‡¦ðŸ‡²",code:"am"},{name:"Australia",emoji:"ðŸ‡¦ðŸ‡º",code:"au"},
  { name:"Austria",emoji:"ðŸ‡¦ðŸ‡¹",code:"at"},{name:"Azerbaijan",emoji:"ðŸ‡¦ðŸ‡¿",code:"az"},
  { name:"Bahamas",emoji:"ðŸ‡§ðŸ‡¸",code:"bs"},{name:"Bahrain",emoji:"ðŸ‡§ðŸ‡­",code:"bh"},
  { name:"Bangladesh",emoji:"ðŸ‡§ðŸ‡©",code:"bd"},{name:"Belarus",emoji:"ðŸ‡§ðŸ‡¾",code:"by"},
  { name:"Belgium",emoji:"ðŸ‡§ðŸ‡ª",code:"be"},{name:"Bolivia",emoji:"ðŸ‡§ðŸ‡´",code:"bo"},
  { name:"Bosnia",emoji:"ðŸ‡§ðŸ‡¦",code:"ba"},{name:"Botswana",emoji:"ðŸ‡§ðŸ‡¼",code:"bw"},
  { name:"Brazil",emoji:"ðŸ‡§ðŸ‡·",code:"br"},{name:"Bulgaria",emoji:"ðŸ‡§ðŸ‡¬",code:"bg"},
  { name:"Cambodia",emoji:"ðŸ‡°ðŸ‡­",code:"kh"},{name:"Cameroon",emoji:"ðŸ‡¨ðŸ‡²",code:"cm"},
  { name:"Canada",emoji:"ðŸ‡¨ðŸ‡¦",code:"ca"},{name:"Chile",emoji:"ðŸ‡¨ðŸ‡±",code:"cl"},
  { name:"China",emoji:"ðŸ‡¨ðŸ‡³",code:"cn"},{name:"Colombia",emoji:"ðŸ‡¨ðŸ‡´",code:"co"},
  { name:"Costa Rica",emoji:"ðŸ‡¨ðŸ‡·",code:"cr"},{name:"Croatia",emoji:"ðŸ‡­ðŸ‡·",code:"hr"},
  { name:"Cuba",emoji:"ðŸ‡¨ðŸ‡º",code:"cu"},{name:"Cyprus",emoji:"ðŸ‡¨ðŸ‡¾",code:"cy"},
  { name:"Czechia",emoji:"ðŸ‡¨ðŸ‡¿",code:"cz"},{name:"Denmark",emoji:"ðŸ‡©ðŸ‡°",code:"dk"},
  { name:"Dominican Republic",emoji:"ðŸ‡©ðŸ‡´",code:"do"},{name:"Ecuador",emoji:"ðŸ‡ªðŸ‡¨",code:"ec"},
  { name:"Egypt",emoji:"ðŸ‡ªðŸ‡¬",code:"eg"},{name:"El Salvador",emoji:"ðŸ‡¸ðŸ‡»",code:"sv"},
  { name:"Estonia",emoji:"ðŸ‡ªðŸ‡ª",code:"ee"},{name:"Ethiopia",emoji:"ðŸ‡ªðŸ‡¹",code:"et"},
  { name:"Finland",emoji:"ðŸ‡«ðŸ‡®",code:"fi"},{name:"France",emoji:"ðŸ‡«ðŸ‡·",code:"fr"},
  { name:"Georgia",emoji:"ðŸ‡¬ðŸ‡ª",code:"ge"},{name:"Germany",emoji:"ðŸ‡©ðŸ‡ª",code:"de"},
  { name:"Ghana",emoji:"ðŸ‡¬ðŸ‡­",code:"gh"},{name:"Greece",emoji:"ðŸ‡¬ðŸ‡·",code:"gr"},
  { name:"Guatemala",emoji:"ðŸ‡¬ðŸ‡¹",code:"gt"},{name:"Honduras",emoji:"ðŸ‡­ðŸ‡³",code:"hn"},
  { name:"Hungary",emoji:"ðŸ‡­ðŸ‡º",code:"hu"},{name:"Iceland",emoji:"ðŸ‡®ðŸ‡¸",code:"is"},
  { name:"India",emoji:"ðŸ‡®ðŸ‡³",code:"in"},{name:"Indonesia",emoji:"ðŸ‡®ðŸ‡©",code:"id"},
  { name:"Iran",emoji:"ðŸ‡®ðŸ‡·",code:"ir"},{name:"Iraq",emoji:"ðŸ‡®ðŸ‡¶",code:"iq"},
  { name:"Ireland",emoji:"ðŸ‡®ðŸ‡ª",code:"ie"},{name:"Israel",emoji:"ðŸ‡®ðŸ‡±",code:"il"},
  { name:"Italy",emoji:"ðŸ‡®ðŸ‡¹",code:"it"},{name:"Jamaica",emoji:"ðŸ‡¯ðŸ‡²",code:"jm"},
  { name:"Japan",emoji:"ðŸ‡¯ðŸ‡µ",code:"jp"},{name:"Jordan",emoji:"ðŸ‡¯ðŸ‡´",code:"jo"},
  { name:"Kazakhstan",emoji:"ðŸ‡°ðŸ‡¿",code:"kz"},{name:"Kenya",emoji:"ðŸ‡°ðŸ‡ª",code:"ke"},
  { name:"Kuwait",emoji:"ðŸ‡°ðŸ‡¼",code:"kw"},{name:"Latvia",emoji:"ðŸ‡±ðŸ‡»",code:"lv"},
  { name:"Lebanon",emoji:"ðŸ‡±ðŸ‡§",code:"lb"},{name:"Lithuania",emoji:"ðŸ‡±ðŸ‡¹",code:"lt"},
  { name:"Luxembourg",emoji:"ðŸ‡±ðŸ‡º",code:"lu"},{name:"Malaysia",emoji:"ðŸ‡²ðŸ‡¾",code:"my"},
  { name:"Mexico",emoji:"ðŸ‡²ðŸ‡½",code:"mx"},{name:"Moldova",emoji:"ðŸ‡²ðŸ‡©",code:"md"},
  { name:"Morocco",emoji:"ðŸ‡²ðŸ‡¦",code:"ma"},{name:"Netherlands",emoji:"ðŸ‡³ðŸ‡±",code:"nl"},
  { name:"New Zealand",emoji:"ðŸ‡³ðŸ‡¿",code:"nz"},{name:"Nigeria",emoji:"ðŸ‡³ðŸ‡¬",code:"ng"},
  { name:"North Macedonia",emoji:"ðŸ‡²ðŸ‡°",code:"mk"},{name:"Norway",emoji:"ðŸ‡³ðŸ‡´",code:"no"},
  { name:"Oman",emoji:"ðŸ‡´ðŸ‡²",code:"om"},{name:"Pakistan",emoji:"ðŸ‡µðŸ‡°",code:"pk"},
  { name:"Panama",emoji:"ðŸ‡µðŸ‡¦",code:"pa"},{name:"Paraguay",emoji:"ðŸ‡µðŸ‡¾",code:"py"},
  { name:"Peru",emoji:"ðŸ‡µðŸ‡ª",code:"pe"},{name:"Philippines",emoji:"ðŸ‡µðŸ‡­",code:"ph"},
  { name:"Poland",emoji:"ðŸ‡µðŸ‡±",code:"pl"},{name:"Portugal",emoji:"ðŸ‡µðŸ‡¹",code:"pt"},
  { name:"Qatar",emoji:"ðŸ‡¶ðŸ‡¦",code:"qa"},{name:"Romania",emoji:"ðŸ‡·ðŸ‡´",code:"ro"},
  { name:"Saudi Arabia",emoji:"ðŸ‡¸ðŸ‡¦",code:"sa"},{name:"Serbia",emoji:"ðŸ‡·ðŸ‡¸",code:"rs"},
  { name:"Singapore",emoji:"ðŸ‡¸ðŸ‡¬",code:"sg"},{name:"Slovakia",emoji:"ðŸ‡¸ðŸ‡°",code:"sk"},
  { name:"Slovenia",emoji:"ðŸ‡¸ðŸ‡®",code:"si"},{name:"South Africa",emoji:"ðŸ‡¿ðŸ‡¦",code:"za"},
  { name:"South Korea",emoji:"ðŸ‡°ðŸ‡·",code:"kr"},{name:"Spain",emoji:"ðŸ‡ªðŸ‡¸",code:"es"},
  { name:"Sweden",emoji:"ðŸ‡¸ðŸ‡ª",code:"se"},{name:"Switzerland",emoji:"ðŸ‡¨ðŸ‡­",code:"ch"},
  { name:"Thailand",emoji:"ðŸ‡¹ðŸ‡­",code:"th"},{name:"Tunisia",emoji:"ðŸ‡¹ðŸ‡³",code:"tn"},
  { name:"Turkey",emoji:"ðŸ‡¹ðŸ‡·",code:"tr"},{name:"Ukraine",emoji:"ðŸ‡ºðŸ‡¦",code:"ua"},
  { name:"United Arab Emirates",emoji:"ðŸ‡¦ðŸ‡ª",code:"ae"},{name:"United Kingdom",emoji:"ðŸ‡¬ðŸ‡§",code:"gb"},
  { name:"United States",emoji:"ðŸ‡ºðŸ‡¸",code:"us"},{name:"Uruguay",emoji:"ðŸ‡ºðŸ‡¾",code:"uy"},
  { name:"Uzbekistan",emoji:"ðŸ‡ºðŸ‡¿",code:"uz"},{name:"Venezuela",emoji:"ðŸ‡»ðŸ‡ª",code:"ve"},
  { name:"Vietnam",emoji:"ðŸ‡»ðŸ‡³",code:"vn"},{name:"Zimbabwe",emoji:"ðŸ‡¿ðŸ‡¼",code:"zw"}
];

// OS detection - Windows doesn't render flag emojis natively
const isWindows = /Windows/i.test(navigator.userAgent);

// Image cache for preloaded flags
const imageCache = {};

// Preload all flag images on Windows
function preloadFlags() {
  if (!isWindows) return;
  flags.forEach(flag => {
    const img = new Image();
    img.src = `https://flagcdn.com/w160/${flag.code}.png`;
    img.onload = () => { imageCache[flag.code] = img; };
  });
}

// Render flag as emoji or image based on OS
function renderFlag(flag, size = 'normal') {
  if (!isWindows) {
    return flag.emoji;
  }
  const width = size === 'large' ? 160 : 80;
  const cached = imageCache[flag.code];
  const loadedClass = cached ? 'loaded' : '';
  return `<img src="https://flagcdn.com/w160/${flag.code}.png" 
          alt="${flag.name} flag" 
          class="${loadedClass}"
          onload="this.classList.add('loaded')" 
          width="${width}">`;
}

let currentRound = [...flags];
let nextRound = [];
let eliminated = [];
let matchIndex = 0;
let roundNumber = 1;
const totalRounds = Math.ceil(Math.log2(flags.length));

// Start preloading on Windows
preloadFlags();

function roundLabel(size) {
  return size === 128 ? "First round" :
         size === 64  ? "Round of 64" :
         size === 32  ? "Round of 32" :
         size === 16  ? "Round of 16" :
         size === 8   ? "Quarter-finals" :
         size === 4   ? "Semi-finals" :
         size === 2   ? "Final" : "";
}

function renderMatch() {
  const app = document.getElementById("app");
  const showNames = document.getElementById("toggleNames").checked;

  document.getElementById("roundInfo").textContent =
    `${roundLabel(currentRound.length)} â€” Round ${roundNumber} of ${totalRounds}`;

  if (currentRound.length === 1) {
    const ranking = [currentRound[0], ...eliminated.reverse()];
    app.innerHTML = `
      <div class="winner">
        <h2>Winner</h2>
        <div class="flag">${renderFlag(ranking[0], 'large')}</div>
        <p>${ranking[0].name}</p>
      </div>
      <div class="ranking">
        <h3>Final rankings (1â€“${ranking.length})</h3>
        <ol>${ranking.map(f => `<li>${renderFlag(f)} ${f.name}</li>`).join("")}</ol>
      </div>
    `;
    return;
  }

  const a = currentRound[matchIndex];
  const b = currentRound[matchIndex + 1];

  app.innerHTML = `
    <div class="match">
      <div class="flag-card">
        <div class="flag">${renderFlag(a)}</div>
        <button onclick="pickWinner(${matchIndex}, ${matchIndex + 1})">
          ${showNames ? a.name : "Select"}
        </button>
      </div>
      <div class="flag-card">
        <div class="flag">${renderFlag(b)}</div>
        <button onclick="pickWinner(${matchIndex + 1}, ${matchIndex})">
          ${showNames ? b.name : "Select"}
        </button>
      </div>
    </div>
  `;
}

function pickWinner(winnerIndex, loserIndex) {
  const winner = currentRound[winnerIndex];
  const loser = currentRound[loserIndex];

  nextRound.push(winner);
  eliminated.push(loser);
  matchIndex += 2;

  if (matchIndex >= currentRound.length) {
    currentRound = nextRound;
    nextRound = [];
    matchIndex = 0;
    roundNumber++;
  }

  renderMatch();
}

document.getElementById("toggleNames").addEventListener("change", renderMatch);
renderMatch();
</script>

</body>
</html>
